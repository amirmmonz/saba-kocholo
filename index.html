<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿµÿ®ÿß ⁄©Ÿà⁄ÜŸàŸÑŸà üçì</title>
    <link rel="icon" type="image/webp" href="barry.webp">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: radial-gradient(circle at 50% 50%, #ffc6d9 0%, #ff8fab 50%, #ff6b9d 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
            cursor: none; /* Hide default cursor */
        }

        /* Three.js 3D Canvas */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
        }

        .barry-container {
            position: relative;
            display: inline-block;
            cursor: pointer;
            filter: drop-shadow(0 25px 50px rgba(255, 107, 157, 0.6)) drop-shadow(0 0 30px rgba(255, 255, 255, 0.4));
        }

        .barry-img {
            width: 300px;
            height: 300px;
            will-change: transform;
            pointer-events: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-user-drag: none;
        }

        .title {
            font-size: 4rem;
            font-weight: 900;
            margin-top: 40px;
            position: relative;
            display: inline-block;
        }

        .title-text {
            color: #ffffff;
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 1),
                0 0 20px rgba(255, 255, 255, 0.8),
                0 0 30px rgba(255, 182, 193, 0.6),
                0 0 40px rgba(255, 182, 193, 0.4),
                0 0 60px rgba(255, 107, 157, 0.3),
                0 5px 20px rgba(255, 107, 157, 0.2);
            letter-spacing: 0.08em;
            animation: text-glow-pulse 2.5s ease-in-out infinite, text-shimmer 4s ease-in-out infinite;
            position: relative;
            display: inline-block;
        }

        @keyframes text-glow-pulse {
            0%, 100% {
                text-shadow: 
                    0 0 10px rgba(255, 255, 255, 1),
                    0 0 20px rgba(255, 255, 255, 0.8),
                    0 0 30px rgba(255, 182, 193, 0.6),
                    0 0 40px rgba(255, 182, 193, 0.4),
                    0 0 60px rgba(255, 107, 157, 0.3),
                    0 5px 20px rgba(255, 107, 157, 0.2);
            }
            50% {
                text-shadow: 
                    0 0 20px rgba(255, 255, 255, 1),
                    0 0 30px rgba(255, 255, 255, 1),
                    0 0 45px rgba(255, 182, 193, 0.9),
                    0 0 60px rgba(255, 182, 193, 0.7),
                    0 0 80px rgba(255, 107, 157, 0.5),
                    0 8px 35px rgba(255, 107, 157, 0.4);
            }
        }

        @keyframes text-shimmer {
            0%, 100% {
                filter: brightness(1) contrast(1);
            }
            50% {
                filter: brightness(1.15) contrast(1.1);
            }
        }

        .glow-ring {
            position: absolute;
            width: 380px;
            height: 380px;
            border-radius: 50%;
            border: none; /* Removed border */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.15); /* Only subtle outer glow */
        }

        .heart-particle {
            position: fixed;
            pointer-events: none;
            z-index: 100;
            font-size: 2rem;
            will-change: transform, opacity;
            filter: drop-shadow(0 0 15px rgba(255, 107, 157, 0.9));
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.8);
            width: 0;
            height: 0;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 1;
            box-shadow: 0 0 30px rgba(255, 255, 255, 1);
        }

        .cursor-trail {
            position: fixed;
            pointer-events: none;
            z-index: 50;
            font-size: 20px;
            opacity: 1;
            will-change: transform, opacity;
            filter: drop-shadow(0 0 10px rgba(255, 107, 157, 0.8));
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 235, 240, 0.98));
            padding: 60px 80px;
            border-radius: 35px;
            box-shadow: 0 30px 80px rgba(255, 107, 157, 0.5), 0 0 60px rgba(255, 255, 255, 0.3);
            text-align: center;
            max-width: 90%;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .modal-content p {
            color: #ff6b9d;
            font-size: 2.8rem;
            font-weight: 900;
            margin: 0;
            line-height: 1.5;
            text-shadow: 2px 2px 30px rgba(255, 182, 193, 0.5);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b9d, #ff8fab);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.8rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
            font-weight: bold;
        }

        .modal-close:hover {
            transform: scale(1.15) rotate(90deg);
            box-shadow: 0 8px 30px rgba(255, 107, 157, 0.6);
        }

        .confetti-piece {
            position: fixed;
            pointer-events: none;
            z-index: 1100;
            font-size: 20px;
            will-change: transform, opacity;
        }

        .bg-ripple {
            position: fixed;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.6);
            pointer-events: none;
            z-index: 2;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        /* Custom Strawberry Cursor */
        .custom-cursor {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 24px;
            transform: translate(-50%, -50%);
            filter: drop-shadow(0 0 8px rgba(255, 107, 157, 0.6));
            transition: transform 0.1s ease-out;
        }

        .custom-cursor.clicking {
            transform: translate(-50%, -50%) scale(1.3);
        }

        /* Barry Particle Trail */
        .barry-trail {
            position: fixed;
            pointer-events: none;
            z-index: 8;
            font-size: 16px;
            will-change: transform, opacity;
        }

        /* Background Stars */
        .bg-star {
            position: fixed;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        @media (max-width: 768px) {
            .barry-img {
                width: 260px;
                height: 260px;
            }
            .title {
                font-size: 3.2rem;
                margin-top: 30px;
            }
            .title-text {
                letter-spacing: 0.03em;
            }
            .glow-ring {
                width: 320px;
                height: 320px;
            }
            .modal-content {
                padding: 40px 50px;
            }
            .modal-content p {
                font-size: 2rem;
            }
            .cursor-trail {
                font-size: 16px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        body {
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>
    <!-- Three.js 3D Background -->
    <canvas id="three-canvas"></canvas>

    <div class="container">
        <div class="barry-container" id="barry">
            <div class="glow-ring" id="glowRing"></div>
            <img src="barry.webp" alt="Barry the Strawberry" class="barry-img" id="barryImg">
        </div>
        <div>
            <h1 class="title" id="title"></h1>
        </div>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">√ó</button>
            <p>ŸáŸÖ€åÿ¥Ÿá ÿÆŸàÿ® ÿ®ÿßÿ¥Ÿá ÿ®⁄ÜŸá üçì</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    
    <script>
        const isMobile = window.innerWidth <= 768;

        // === CUSTOM STRAWBERRY CURSOR ===
        if (!isMobile) { // Only on desktop
            const cursor = document.createElement('div');
            cursor.className = 'custom-cursor';
            cursor.innerHTML = 'üçì';
            document.body.appendChild(cursor);

            let cursorX = 0;
            let cursorY = 0;
            let currentX = 0;
            let currentY = 0;

            document.addEventListener('mousemove', (e) => {
                cursorX = e.clientX;
                cursorY = e.clientY;
            });

            document.addEventListener('mousedown', () => {
                cursor.classList.add('clicking');
            });

            document.addEventListener('mouseup', () => {
                cursor.classList.remove('clicking');
            });

            // Smooth cursor animation
            function animateCursor() {
                currentX += (cursorX - currentX) * 0.2;
                currentY += (cursorY - currentY) * 0.2;
                cursor.style.left = currentX + 'px';
                cursor.style.top = currentY + 'px';
                requestAnimationFrame(animateCursor);
            }
            animateCursor();
        }

        // === BACKGROUND STARS ===
        function createBackgroundStars() {
            const starCount = isMobile ? 40 : 80;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'bg-star';
                star.style.left = Math.random() * window.innerWidth + 'px';
                star.style.top = Math.random() * window.innerHeight + 'px';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (Math.random() * 2 + 2) + 's';
                
                // Random size variation
                const size = Math.random() * 2 + 2;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                
                document.body.appendChild(star);
            }
        }
        createBackgroundStars();

        // === THREE.JS 3D GLOWING PARTICLES ===
        let scene, camera, renderer, particles = [];
        let mouseX = 0, mouseY = 0;

        function initThreeJS() {
            scene = new THREE.Scene();

            // Subtle fog for depth
            scene.fog = new THREE.Fog(0xff8fab, 20, 50);

            // Moderate FOV for natural look
            camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 20;

            const canvas = document.getElementById('three-canvas');
            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                alpha: true,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // Create emoji textures with proper transparency
            function createEmojiTexture(emoji, size = 64) {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                
                // Clear canvas to ensure transparency
                ctx.clearRect(0, 0, size, size);
                
                // Draw emoji without background
                ctx.font = `${size - 10}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(emoji, size / 2, size / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                texture.needsUpdate = true;
                return texture;
            }

            const strawberryTexture = createEmojiTexture('üçì', 72);
            const heartTexture = createEmojiTexture('üíñ', 72);
            const sparkleTexture = createEmojiTexture('‚ú®', 64);

            // Create 3D particles with better mobile visibility
            const particleCount = isMobile ? 60 : 70; // More on mobile
            
            for (let i = 0; i < particleCount; i++) {
                const rand = Math.random();
                const texture = rand > 0.75 ? sparkleTexture : (rand > 0.65 ? heartTexture : strawberryTexture);
                
                const spriteMaterial = new THREE.SpriteMaterial({
                    map: texture,
                    transparent: true,
                    opacity: 1,
                    depthTest: true,
                    depthWrite: false, // Better blending
                    fog: true,
                    blending: THREE.NormalBlending
                });
                
                const sprite = new THREE.Sprite(spriteMaterial);
                
                // CONTROLLED depth range for consistency
                const z = (Math.random() - 0.5) * 30; // -15 to +15
                sprite.position.x = (Math.random() - 0.5) * 45;
                sprite.position.y = Math.random() * 35 + 15;
                sprite.position.z = z;
                
                // Better visibility on mobile with larger sizes
                const depthFactor = (z + 15) / 30; // 0 to 1
                const baseScale = isMobile ? 1.2 : 0.9; // Bigger on mobile
                const scaleRange = isMobile ? 1.2 : 1.0;
                const scale = baseScale + depthFactor * scaleRange; // Mobile: 1.2-2.4, Desktop: 0.9-1.9
                sprite.scale.set(scale, scale, 1);
                
                // Higher opacity on mobile for better visibility
                const baseOpacity = isMobile ? 0.75 : 0.6;
                spriteMaterial.opacity = baseOpacity + depthFactor * 0.3;
                
                sprite.userData.speed = 0.018 + depthFactor * 0.022;
                sprite.userData.rotationSpeed = (Math.random() - 0.5) * 0.03;
                sprite.userData.swayAmplitude = Math.random() * 1.2;
                sprite.userData.swaySpeed = Math.random() * 1.2 + 0.5;
                sprite.userData.swayOffset = Math.random() * Math.PI * 2;
                
                scene.add(sprite);
                particles.push(sprite);
            }

            // GLOWING LIGHTS for pink/white aesthetic
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            // Main pink glow
            const pinkLight1 = new THREE.PointLight(0xff6b9d, 2, 50);
            pinkLight1.position.set(0, 0, 15);
            scene.add(pinkLight1);

            // White sparkle light
            const whiteLight1 = new THREE.PointLight(0xffffff, 1.5, 40);
            whiteLight1.position.set(15, 10, 10);
            scene.add(whiteLight1);

            const whiteLight2 = new THREE.PointLight(0xffffff, 1.5, 40);
            whiteLight2.position.set(-15, -10, 10);
            scene.add(whiteLight2);

            // Moving pink glow
            const movingPinkLight = new THREE.PointLight(0xffc6d9, 2, 35);
            scene.add(movingPinkLight);

            // Subtle cyan rim light for depth
            const rimLight = new THREE.PointLight(0xddffff, 0.8, 45);
            rimLight.position.set(0, -15, -5);
            scene.add(rimLight);

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            let time = 0;
            function animate3D() {
                requestAnimationFrame(animate3D);
                time += 0.008;

                // Animate particles
                particles.forEach((particle) => {
                    particle.position.y -= particle.userData.speed;
                    particle.rotation.z += particle.userData.rotationSpeed;
                    
                    // Gentle sway
                    const swayTime = time * particle.userData.swaySpeed + particle.userData.swayOffset;
                    particle.position.x += Math.sin(swayTime) * 0.04 * particle.userData.swayAmplitude;
                    
                    // Respawn at top with consistent size
                    if (particle.position.y < -15) {
                        particle.position.y = 30;
                        particle.position.x = (Math.random() - 0.5) * 45;
                        const z = (Math.random() - 0.5) * 30;
                        particle.position.z = z;
                        
                        const depthFactor = (z + 15) / 30;
                        const baseScale = isMobile ? 1.2 : 0.9;
                        const scaleRange = isMobile ? 1.2 : 1.0;
                        const scale = baseScale + depthFactor * scaleRange;
                        particle.scale.set(scale, scale, 1);
                        
                        const baseOpacity = isMobile ? 0.75 : 0.6;
                        particle.material.opacity = baseOpacity + depthFactor * 0.3;
                    }
                });

                // Animate moving light
                movingPinkLight.position.x = Math.sin(time * 0.6) * 15;
                movingPinkLight.position.y = Math.cos(time * 0.4) * 12;
                movingPinkLight.position.z = Math.sin(time * 0.8) * 8 + 12;

                // VERY SMOOTH camera movement (no sudden changes)
                const targetX = mouseX * 3; // Further reduced from 4
                const targetY = mouseY * 3;
                
                camera.position.x += (targetX - camera.position.x) * 0.03; // Slower interpolation
                camera.position.y += (targetY - camera.position.y) * 0.03;
                
                // Very subtle rotation
                camera.rotation.y = mouseX * 0.03; // Reduced from 0.05
                camera.rotation.x = -mouseY * 0.03;
                
                camera.lookAt(scene.position);

                renderer.render(scene, camera);
            }

            animate3D();
        }

        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        document.addEventListener('touchmove', (e) => {
            if (e.touches[0]) {
                mouseX = (e.touches[0].clientX / window.innerWidth) * 2 - 1;
                mouseY = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
            }
        }, { passive: true });

        if (typeof THREE !== 'undefined') {
            setTimeout(initThreeJS, 100);
        }

        // === GSAP 2D ANIMATIONS ===
        function initAnimation() {
            const titleText = "ÿµÿ®ÿß ⁄©Ÿà⁄ÜŸàŸÑŸà";
            const titleElement = document.getElementById('title');
            
            const span = document.createElement('span');
            span.className = 'title-text';
            span.textContent = titleText;
            titleElement.appendChild(span);

            const titleTextElement = document.querySelector('.title-text');
            const barryContainer = document.getElementById('barry');
            const barryImg = document.getElementById('barryImg');
            const glowRing = document.getElementById('glowRing');
            const modal = document.getElementById('modal');
            const modalClose = document.getElementById('modalClose');
            const modalContent = modal.querySelector('.modal-content');

            let isModalOpen = false;
            let clickCount = 0;
            let clickTimer = null;
            let lastClickTime = 0;

            if (typeof gsap !== 'undefined') {
                gsap.defaults({ ease: "power2.out" });

                // Entrance
                gsap.from(barryImg, {
                    duration: 1.8,
                    scale: 0,
                    rotation: -270,
                    ease: "elastic.out(0.9, 0.5)",
                    delay: 0.3
                });

                gsap.to(glowRing, {
                    duration: 1.2,
                    opacity: 0.25, // Even more subtle
                    scale: 1.2,
                    delay: 0.8,
                    ease: "power2.out"
                });

                gsap.from(titleTextElement, {
                    duration: 1.4,
                    opacity: 0,
                    y: 60,
                    scale: 0.4,
                    delay: 1.1,
                    ease: "back.out(2)"
                });

                // Floating animations
                gsap.to(barryImg, {
                    y: -20,
                    duration: 2.8,
                    ease: "sine.inOut",
                    repeat: -1,
                    yoyo: true
                });

                gsap.to(barryImg, {
                    rotation: 5,
                    duration: 5.5,
                    ease: "sine.inOut",
                    repeat: -1,
                    yoyo: true
                });

                // Removed scale animation to prevent size jumping

                gsap.to(glowRing, {
                    scale: 1.35,
                    opacity: 0.15, // Barely visible
                    rotation: 360,
                    duration: 15,
                    ease: "linear",
                    repeat: -1
                });

                // No repeating animation - text stays stable after entrance

                // === PARTICLE TRAIL ON BARRY ===
                let barryTrailTimer = 0;
                const barryTrailInterval = 100; // Create trail every 100ms

                function createBarryTrail() {
                    const barryRect = barryContainer.getBoundingClientRect();
                    const centerX = barryRect.left + barryRect.width / 2;
                    const centerY = barryRect.top + barryRect.height / 2;
                    
                    const trail = document.createElement('div');
                    trail.className = 'barry-trail';
                    trail.innerHTML = ['üíñ', '‚ú®', 'üíï', '‚≠ê'][Math.floor(Math.random() * 4)];
                    trail.style.left = centerX + (Math.random() - 0.5) * 80 + 'px';
                    trail.style.top = centerY + (Math.random() - 0.5) * 80 + 'px';
                    document.body.appendChild(trail);

                    if (typeof gsap !== 'undefined') {
                        gsap.to(trail, {
                            y: -40,
                            x: (Math.random() - 0.5) * 30,
                            rotation: Math.random() * 360,
                            scale: 0.5,
                            opacity: 0,
                            duration: 1.5,
                            ease: "power2.out",
                            onComplete: () => trail.remove()
                        });
                    }
                }

                setInterval(createBarryTrail, barryTrailInterval);

                // === BARRY REACTS TO CURSOR ===
                let lastCursorX = 0;
                let lastCursorY = 0;

                document.addEventListener('mousemove', (e) => {
                    lastCursorX = e.clientX;
                    lastCursorY = e.clientY;

                    // Check distance to Barry
                    const barryRect = barryContainer.getBoundingClientRect();
                    const barryCenterX = barryRect.left + barryRect.width / 2;
                    const barryCenterY = barryRect.top + barryRect.height / 2;
                    
                    const dx = e.clientX - barryCenterX;
                    const dy = e.clientY - barryCenterY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // If cursor is close to Barry (within 300px), he leans toward it
                    if (distance < 300) {
                        const angle = Math.atan2(dy, dx);
                        const tiltX = Math.sin(angle) * 8; // Tilt up/down
                        const tiltY = Math.cos(angle) * 8; // Tilt left/right
                        
                        gsap.to(barryImg, {
                            rotationX: tiltX,
                            rotationY: -tiltY,
                            duration: 0.6,
                            ease: "power2.out"
                        });
                    } else {
                        // Return to normal
                        gsap.to(barryImg, {
                            rotationX: 0,
                            rotationY: 0,
                            duration: 0.8,
                            ease: "power2.out"
                        });
                    }
                });

                // Smooth parallax (title moves slightly opposite)
                document.addEventListener('mousemove', (e) => {
                    const intensity = isMobile ? 0.3 : 0.6; // Gentle intensity
                    const x = (e.clientX / window.innerWidth - 0.5) * 18 * intensity;
                    const y = (e.clientY / window.innerHeight - 0.5) * 18 * intensity;
                    
                    gsap.to(barryContainer, {
                        x: x,
                        y: y,
                        duration: 1.2, // Longer duration for smoothness
                        ease: "power1.out" // Gentler easing
                    });

                    gsap.to(titleElement, {
                        x: -x * 0.2, // Reduced from 0.4
                        y: -y * 0.2, // Reduced from 0.4
                        duration: 1.4, // Even smoother for text
                        ease: "power1.out"
                    });
                });

                // Click/Double-click
                function handleBarryClick(e) {
                    if (isModalOpen) return;
                    
                    const currentTime = Date.now();
                    const timeSinceLastClick = currentTime - lastClickTime;
                    
                    clickCount++;
                    
                    if (clickCount === 1) {
                        lastClickTime = currentTime;
                        singleClickAnimation(e);
                        
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                            lastClickTime = 0;
                        }, 300);
                    } else if (clickCount === 2) {
                        if (timeSinceLastClick < 300) {
                            clearTimeout(clickTimer);
                            clickCount = 0;
                            lastClickTime = 0;
                            showModal();
                        } else {
                            clickCount = 1;
                            lastClickTime = currentTime;
                            singleClickAnimation(e);
                            
                            clearTimeout(clickTimer);
                            clickTimer = setTimeout(() => {
                                clickCount = 0;
                                lastClickTime = 0;
                            }, 300);
                        }
                    }
                }
                
                function singleClickAnimation(e) {
                    gsap.timeline()
                        .to(barryImg, {
                            scale: 1.25,
                            rotation: "+=12",
                            duration: 0.2,
                            ease: "power2.out"
                        })
                        .to(barryImg, {
                            scale: 1,
                            duration: 0.6,
                            ease: "elastic.out(1, 0.3)"
                        });

                    const ripple = document.createElement('div');
                    ripple.className = 'ripple';
                    barryContainer.appendChild(ripple);

                    gsap.to(ripple, {
                        width: 450,
                        height: 450,
                        opacity: 0,
                        duration: 1.1,
                        ease: "power2.out",
                        onComplete: () => ripple.remove()
                    });

                    const clientX = e.clientX || (e.touches && e.touches[0].clientX) || window.innerWidth / 2;
                    const clientY = e.clientY || (e.touches && e.touches[0].clientY) || window.innerHeight / 2;
                    
                    for (let i = 0; i < 10; i++) {
                        const heart = document.createElement('div');
                        heart.className = 'heart-particle';
                        heart.innerHTML = 'üíñ';
                        heart.style.left = clientX + 'px';
                        heart.style.top = clientY + 'px';
                        document.body.appendChild(heart);

                        const angle = (i / 10) * Math.PI * 2;
                        const distance = 180;
                        const tx = Math.cos(angle) * distance;
                        const ty = Math.sin(angle) * distance;

                        gsap.to(heart, {
                            x: tx,
                            y: ty,
                            rotation: 540,
                            scale: 1.3,
                            opacity: 0,
                            duration: 1.8,
                            ease: "power2.out",
                            onComplete: () => heart.remove()
                        });
                    }
                }
                
                
                // === CONFETTI EXPLOSION ON MODAL ===
                function createConfetti() {
                    const confettiCount = isMobile ? 30 : 50;
                    const confettiEmojis = ['üçì', 'üíñ', '‚ú®', 'üíï', 'üå∏', '‚≠ê', 'üí´'];
                    
                    for (let i = 0; i < confettiCount; i++) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti-piece';
                        confetti.innerHTML = confettiEmojis[Math.floor(Math.random() * confettiEmojis.length)];
                        
                        // Start from center
                        const centerX = window.innerWidth / 2;
                        const centerY = window.innerHeight / 2;
                        confetti.style.left = centerX + 'px';
                        confetti.style.top = centerY + 'px';
                        
                        document.body.appendChild(confetti);
                        
                        // Random explosion direction
                        const angle = (Math.random() * Math.PI * 2);
                        const velocity = Math.random() * 300 + 200;
                        const tx = Math.cos(angle) * velocity;
                        const ty = Math.sin(angle) * velocity - 100; // Slight upward bias
                        
                        gsap.to(confetti, {
                            x: tx,
                            y: ty,
                            rotation: Math.random() * 720 - 360,
                            opacity: 0,
                            duration: Math.random() * 1 + 1.5,
                            ease: "power2.out",
                            onComplete: () => confetti.remove()
                        });
                        
                        // Add gravity effect
                        gsap.to(confetti, {
                            y: `+=${Math.random() * 400 + 300}`,
                            duration: Math.random() * 0.8 + 1.2,
                            delay: 0.3,
                            ease: "power1.in"
                        });
                    }
                }
                
                function showModal() {
                    isModalOpen = true;
                    
                    // IMPORTANT: Clear any inline styles first
                    gsap.set(modalContent, { clearProps: "all" });
                    
                    modal.classList.add('show');
                    
                    // Trigger confetti explosion!
                    createConfetti();
                    
                    // Then animate from fresh state
                    gsap.fromTo(modalContent,
                        { scale: 0.3, opacity: 0, rotation: 0 },
                        {
                            scale: 1,
                            opacity: 1,
                            rotation: 0,
                            duration: 0.7,
                            ease: "back.out(1.7)"
                        }
                    );
                }
                
                function closeModal() {
                    gsap.to(modalContent, {
                        scale: 0.3,
                        opacity: 0,
                        duration: 0.4,
                        ease: "back.in(1.7)",
                        onComplete: () => {
                            modal.classList.remove('show');
                            isModalOpen = false;
                            // Clear props after closing
                            gsap.set(modalContent, { clearProps: "all" });
                        }
                    });
                }
                
                barryContainer.addEventListener('click', handleBarryClick);
                barryContainer.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    handleBarryClick(e);
                });
                
                modalClose.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closeModal();
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && isModalOpen) {
                        closeModal();
                    }
                    if (e.code === 'Space' && !isModalOpen) {
                        e.preventDefault();
                        barryContainer.click();
                    }
                });

                // === INTERACTIVE BACKGROUND ===
                // Click anywhere to create ripple + sparkle burst
                document.body.addEventListener('click', (e) => {
                    // Don't trigger on Barry, modal, or buttons
                    if (e.target === barryContainer || e.target === barryImg || 
                        e.target.closest('.modal-overlay') || e.target === barryContainer) {
                        return;
                    }
                    
                    const x = e.clientX;
                    const y = e.clientY;
                    
                    // Create expanding ripple
                    const ripple = document.createElement('div');
                    ripple.className = 'bg-ripple';
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.style.width = '0px';
                    ripple.style.height = '0px';
                    document.body.appendChild(ripple);
                    
                    gsap.to(ripple, {
                        width: 300,
                        height: 300,
                        left: x - 150,
                        top: y - 150,
                        opacity: 0,
                        duration: 1,
                        ease: "power2.out",
                        onComplete: () => ripple.remove()
                    });
                    
                    // Create sparkle burst
                    const burstCount = isMobile ? 6 : 10;
                    for (let i = 0; i < burstCount; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.innerHTML = ['‚ú®', 'üí´', '‚≠ê'][Math.floor(Math.random() * 3)];
                        sparkle.style.position = 'fixed';
                        sparkle.style.left = x + 'px';
                        sparkle.style.top = y + 'px';
                        sparkle.style.fontSize = (Math.random() * 10 + 15) + 'px';
                        sparkle.style.pointerEvents = 'none';
                        sparkle.style.zIndex = '50';
                        sparkle.style.filter = 'drop-shadow(0 0 6px rgba(255, 255, 255, 0.8))';
                        document.body.appendChild(sparkle);
                        
                        const angle = (i / burstCount) * Math.PI * 2;
                        const distance = Math.random() * 80 + 40;
                        const tx = Math.cos(angle) * distance;
                        const ty = Math.sin(angle) * distance;
                        
                        gsap.to(sparkle, {
                            x: tx,
                            y: ty,
                            rotation: Math.random() * 360,
                            opacity: 0,
                            scale: 0.5,
                            duration: 0.8,
                            ease: "power2.out",
                            onComplete: () => sparkle.remove()
                        });
                    }
                });

                // One-time entrance flash only (no repeating)
                function createEntranceFlash() {
                    const flash = document.createElement('div');
                    flash.style.position = 'fixed';
                    flash.style.left = '50%';
                    flash.style.top = titleElement.getBoundingClientRect().top + titleElement.offsetHeight / 2 + 'px';
                    flash.style.transform = 'translate(-50%, -50%)';
                    flash.style.width = '400px';
                    flash.style.height = '400px';
                    flash.style.background = 'radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 70%)';
                    flash.style.pointerEvents = 'none';
                    flash.style.zIndex = '5';
                    document.body.appendChild(flash);

                    gsap.fromTo(flash,
                        { scale: 0, opacity: 1 },
                        {
                            scale: 2,
                            opacity: 0,
                            duration: 0.8,
                            ease: "power2.out",
                            onComplete: () => flash.remove()
                        }
                    );
                }
                // Trigger once during entrance
                setTimeout(createEntranceFlash, 1200);

                // Subtle sparkle particles around text (less frequent)
                function createTextSparkleParticle() {
                    const titleRect = titleElement.getBoundingClientRect();
                    const sparkle = document.createElement('div');
                    sparkle.innerHTML = ['‚ú®', 'üí´', '‚≠ê'][Math.floor(Math.random() * 3)];
                    sparkle.style.position = 'fixed';
                    
                    // Spawn around the text edges
                    const side = Math.random();
                    if (side < 0.5) {
                        sparkle.style.left = (titleRect.left + (Math.random() > 0.5 ? -20 : titleRect.width + 20)) + 'px';
                        sparkle.style.top = (titleRect.top + Math.random() * titleRect.height) + 'px';
                    } else {
                        sparkle.style.left = (titleRect.left + Math.random() * titleRect.width) + 'px';
                        sparkle.style.top = (titleRect.top + (Math.random() > 0.5 ? -20 : titleRect.height + 20)) + 'px';
                    }
                    
                    sparkle.style.fontSize = (Math.random() * 10 + 16) + 'px';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.zIndex = '20';
                    sparkle.style.filter = 'drop-shadow(0 0 6px rgba(255, 255, 255, 0.8))';
                    document.body.appendChild(sparkle);

                    gsap.fromTo(sparkle,
                        { scale: 0, opacity: 0, rotation: 0 },
                        {
                            scale: 1.5,
                            opacity: 0.9,
                            rotation: Math.random() * 180,
                            x: (Math.random() - 0.5) * 30,
                            y: (Math.random() - 0.5) * 30,
                            duration: 1.4,
                            ease: "power2.out",
                            onComplete: () => {
                                gsap.to(sparkle, {
                                    opacity: 0,
                                    scale: 2,
                                    duration: 0.4,
                                    onComplete: () => sparkle.remove()
                                });
                            }
                        }
                    );
                }
                setInterval(createTextSparkleParticle, 2000); // Less frequent: 2s instead of 1.2s

                // Gentle light rays (less frequent)
                function createLightRay() {
                    if (Math.random() > 0.5) { // Less frequent
                        const titleRect = titleElement.getBoundingClientRect();
                        const ray = document.createElement('div');
                        ray.style.position = 'fixed';
                        ray.style.left = (titleRect.left + Math.random() * titleRect.width) + 'px';
                        ray.style.top = (titleRect.top + titleRect.height / 2) + 'px';
                        ray.style.width = '1.5px';
                        ray.style.height = '60px';
                        ray.style.background = 'linear-gradient(to bottom, rgba(255, 255, 255, 0.6), transparent)';
                        ray.style.pointerEvents = 'none';
                        ray.style.zIndex = '5';
                        ray.style.transformOrigin = 'top';
                        document.body.appendChild(ray);

                        const angle = Math.random() * 40 - 20;
                        gsap.fromTo(ray,
                            { scaleY: 0, rotation: angle, opacity: 0 },
                            {
                                scaleY: 1,
                                opacity: 0.7,
                                duration: 0.4,
                                ease: "power2.out",
                                onComplete: () => {
                                    gsap.to(ray, {
                                        opacity: 0,
                                        scaleY: 0.5,
                                        duration: 0.5,
                                        onComplete: () => ray.remove()
                                    });
                                }
                            }
                        );
                    }
                }
                setInterval(createLightRay, 2200); // Less frequent: 2.2s instead of 1.6s
            }

            // Cursor trail
            let lastTrailTime = 0;
            
            function createTrailStrawberry(x, y) {
                const trail = document.createElement('div');
                trail.className = 'cursor-trail';
                trail.innerHTML = Math.random() > 0.5 ? '‚ú®' : 'üçì';
                trail.style.left = x + 'px';
                trail.style.top = y + 'px';
                document.body.appendChild(trail);

                if (typeof gsap !== 'undefined') {
                    gsap.to(trail, {
                        y: -50,
                        x: (Math.random() - 0.5) * 35,
                        rotation: Math.random() * 360,
                        scale: 1.8,
                        opacity: 0,
                        duration: 1.4,
                        ease: "power2.out",
                        onComplete: () => trail.remove()
                    });
                }
            }
            
            function handleMove(e) {
                const currentTime = Date.now();
                if (currentTime - lastTrailTime < 55) return;
                
                lastTrailTime = currentTime;
                
                let x, y;
                if (e.touches && e.touches[0]) {
                    x = e.touches[0].clientX;
                    y = e.touches[0].clientY;
                } else {
                    x = e.clientX;
                    y = e.clientY;
                }
                
                createTrailStrawberry(x, y);
            }
            
            document.addEventListener('mousemove', handleMove);
            document.addEventListener('touchmove', handleMove, { passive: true });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initAnimation, 100);
            });
        } else {
            setTimeout(initAnimation, 100);
        }
    </script>
</body>
</html>
